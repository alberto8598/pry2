pipeline {
    agent any

    stages {
        stage('Clone Repository') {
               steps {
                      git branch: 'develop', credentialsId: '112f9878-7c13-4fe6-a745-f95f0c4f47ed', url: 'https://github.com/alberto8598/pry2.git'
                      }
             }
        stage('Ejecutar pruebas unitarias') {
            steps {
                sh 'gradle test'
            }
        }
        stage('Analizar calidad del c√≥digo') {
            steps {
                sh 'gradle sonarqube'
            }
        }
        stage('Construir imagen Docker') {
            steps {
                sh 'docker build -t myapp .'
            }
        }
        stage('Subir imagen Docker') {
           steps {
              withDockerRegistry([credentialsId: '7dd3df4f-f53c-4ad2-bf16-d5352962ae9c', url: 'https://index.docker.io/v1/']) {
                           sh 'docker push curribifine/credibanco'
                 }
            }
        }
    }
}